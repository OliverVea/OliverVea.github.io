<!DOCTYPE html>
<html lang="en-us">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Code Generation from csv file with .NET - Oliver Vea</title><meta name="Description" content="Personal DevBlog of Oliver Vea"><meta property="og:url" content="http://localhost:1313/posts/csv-source-generation/">
  <meta property="og:site_name" content="Oliver Vea">
  <meta property="og:title" content="Code Generation from csv file with .NET">
  <meta property="og:description" content="Setting the stage Recently, I’ve been developing a game with RPG elements. Naturally, this means that there are hundreds of stat values for abilities, characters, items, enemies, and so on.
In the world of game development it can be a good idea to store this kind of data in spreadsheets as it allows for versatile access to the values for analysis, tuning and easy extension.
Without source generation, csv files have significant downsides.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-10-26T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-10-26T00:00:00+00:00">
    <meta property="article:tag" content=".NET">
    <meta property="article:tag" content="Source Generation">
    <meta property="article:tag" content="CSV">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Code Generation from csv file with .NET">
  <meta name="twitter:description" content="Setting the stage Recently, I’ve been developing a game with RPG elements. Naturally, this means that there are hundreds of stat values for abilities, characters, items, enemies, and so on.
In the world of game development it can be a good idea to store this kind of data in spreadsheets as it allows for versatile access to the values for analysis, tuning and easy extension.
Without source generation, csv files have significant downsides.">
<meta name="application-name" content="Oliver Vea Personal DevBlog">
<meta name="apple-mobile-web-app-title" content="Oliver Vea Personal DevBlog"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://localhost:1313/posts/csv-source-generation/" /><link rel="prev" href="http://localhost:1313/posts/elastic-embeddings/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Code Generation from csv file with .NET",
        "inLanguage": "en-us",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/localhost:1313\/posts\/csv-source-generation\/"
        },"genre": "posts","keywords": ".NET, Source Generation, CSV","wordcount":  436 ,
        "url": "http:\/\/localhost:1313\/posts\/csv-source-generation\/","datePublished": "2024-10-26T00:00:00+00:00","dateModified": "2024-10-26T00:00:00+00:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Oliver Vea"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Oliver Vea"><span class="header-title-pre">< </span>Oliver Vea<span class="header-title-post"> /></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Oliver Vea"><span class="header-title-pre">< </span>Oliver Vea<span class="header-title-post"> /></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Code Generation from csv file with .NET</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Oliver Vea</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2024-10-26">2024-10-26</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;436 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;3 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#setting-the-stage">Setting the stage</a></li>
    <li><a href="#introducing-technologies">Introducing technologies</a>
      <ul>
        <li><a href="#source-generation">Source generation</a></li>
        <li><a href="#t4-templates">T4 templates</a></li>
      </ul>
    </li>
    <li><a href="#references">References</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="setting-the-stage">Setting the stage</h2>
<p>Recently, I&rsquo;ve been developing a game with RPG elements. Naturally, this means that there are hundreds of stat values for abilities, characters, items, enemies, and so on.</p>
<p>In the world of game development it can be a good idea to store this kind of data in spreadsheets as it allows for versatile access to the values for analysis, tuning and easy extension.</p>
<p>Without source generation, csv files have significant downsides. Firstly, to read a csv file at runtime, it must be available. If the file cannot be found, it will throw an error. This can show up in unfortunate situations as a <code>dotnet build</code> doesn&rsquo;t necessarily mean that it is possible to run the game, as vital csv files might be missing.</p>
<p>In addition to this, reading and parsing csv files at runtime also has loading time and performance implications. For most use cases it&rsquo;s probably not noticable, but it&rsquo;s something to keep track of, as it is not free.</p>
<p>For a game designer, depending on how spells are designed, the following table might be a good way to work with spell values:</p>
<table>
<thead>
<tr>
<th>Spell</th>
<th>Damage</th>
<th>Range</th>
<th>Cost</th>
</tr>
</thead>
<tbody>
<tr>
<td>Fireball</td>
<td>15</td>
<td>5</td>
<td>15</td>
</tr>
<tr>
<td>Frostbolt</td>
<td>12</td>
<td>5</td>
<td>20</td>
</tr>
<tr>
<td>Heavy Strike</td>
<td>20</td>
<td>0.7</td>
<td>5</td>
</tr>
</tbody>
</table>
<p>As the values of the spells are the domain of the game designer, the programmer does not care about the values themselves and the values do not need to be editable at runtime. Rather, we want type safety, reliability, and performance. Therefore we might prefer the following structure:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Spells</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Spell</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> Damage { <span style="color:#66d9ef">get</span>; }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">float</span> Range { <span style="color:#66d9ef">get</span>; }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> Cost { <span style="color:#66d9ef">get</span>; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> Spell(<span style="color:#66d9ef">int</span> damage, <span style="color:#66d9ef">float</span> range, <span style="color:#66d9ef">int</span> cost) {
</span></span><span style="display:flex;"><span>            Damage = damage;
</span></span><span style="display:flex;"><span>            Range = range;
</span></span><span style="display:flex;"><span>            Cost = cost;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }    
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">readonly</span> Spell Fireball = <span style="color:#66d9ef">new</span>(<span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">15</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">readonly</span> Spell Frostbolt = <span style="color:#66d9ef">new</span>(<span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">20</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">readonly</span> Spell HeavyStrike = <span style="color:#66d9ef">new</span>(<span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">0.7f</span>, <span style="color:#ae81ff">5</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Now while the structure is different, the content of these representations are the same. It is possible to map the first representation to the second one, which is exactly what we will do in this article.</p>
<h2 id="introducing-technologies">Introducing technologies</h2>
<p>The idea for this article was derived from an article, [<a href="#references" rel="">1</a>], on source generation by Luca Bolognese. I&rsquo;ve made two key modifications to the example:</p>
<ol>
<li>A simple but unoptimized parser for the csv file instead of the nuget package used in the article.</li>
<li>A run time t4 template, [<a href="#references" rel="">2</a>], to generate the C# code.</li>
</ol>
<h3 id="source-generation">Source generation</h3>
<h3 id="t4-templates">T4 templates</h3>
<h2 id="references">References</h2>
<ol>
<li><a href="https://devblogs.microsoft.com/dotnet/new-c-source-generator-samples/" target="_blank" rel="noopener noreffer ">Luca Bolognese - New C# Source Generator Samples</a></li>
<li><a href="https://learn.microsoft.com/en-us/visualstudio/modeling/code-generation-and-t4-text-templates?view=vs-2022#run-time-t4-text-templates" target="_blank" rel="noopener noreffer ">Code Generation and T4 Text Templates</a></li>
</ol>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2024-10-26</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="http://localhost:1313/posts/csv-source-generation/" data-title="Code Generation from csv file with .NET" data-hashtags=".NET,Source Generation,CSV"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="http://localhost:1313/posts/csv-source-generation/" data-hashtag=".NET"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Linkedin" data-sharer="linkedin" data-url="http://localhost:1313/posts/csv-source-generation/"><i class="fab fa-linkedin fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Reddit" data-sharer="reddit" data-url="http://localhost:1313/posts/csv-source-generation/"><i class="fab fa-reddit fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="http://localhost:1313/posts/csv-source-generation/" data-title="Code Generation from csv file with .NET"><i data-svg-src="/lib/simple-icons/icons/line.min.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Skype" data-sharer="skype" data-url="http://localhost:1313/posts/csv-source-generation/" data-title="Code Generation from csv file with .NET"><i class="fab fa-skype fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/.net/">.NET</a>,&nbsp;<a href="/tags/source-generation/">Source Generation</a>,&nbsp;<a href="/tags/csv/">CSV</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/elastic-embeddings/" class="prev" rel="prev" title="Semantic Search with OpenAI and Elasticsearch"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Semantic Search with OpenAI and Elasticsearch</a></div>
</div>
</article></div>
            </main></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/lightgallery/css/lightgallery-bundle.min.css"><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lightgallery.min.js"></script><script type="text/javascript" src="/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js"></script><script type="text/javascript" src="/lib/lightgallery/plugins/zoom/lg-zoom.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"lightgallery":true,"search":{"highlightTag":"em","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
